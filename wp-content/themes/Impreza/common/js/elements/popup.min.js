!function($,_undefined){"use strict";var _originalUrl;$us.usPopup=function(container){const self=this;self.$container=$(container);self.$content=$('.w-popup-box-content',self.$container);self.$closer=$('.w-popup-closer',self.$container);self._events={show:self.show.bind(self),afterShow:self.afterShow.bind(self),hide:self.hide.bind(self),hideOnLinkClick:self.hideOnLinkClick.bind(self),afterHide:self.afterHide.bind(self),keyup:(e)=>{if(e.keyCode===$ush.ESC_KEYCODE){self.hide();self.$trigger[0].focus()}},scroll:()=>{$us.$document.trigger('scroll')},touchmove:(e)=>{self.savePopupSizes();if((self.popupSizes.wrapHeight>self.popupSizes.contentHeight)||$(e.target).closest('.w-popup-box').length===0){e.preventDefault()}},tabFocusTrap:self.tabFocusTrap.bind(self)};self.isDesktop=!jQuery.isMobile;self.forListItem=self.$container.hasClass('for_list-item');self.transitionEndEvent=(navigator.userAgent.search(/webkit/i)>0)?'webkitTransitionEnd':'transitionend';self.$trigger=$('.w-popup-trigger',self.$container);self.triggerType=self.$trigger.usMod('type');self.triggerOptions=$ush.toPlainObject(self.$trigger.data('options'));if(self.triggerType==='load'){let _timeoutHandle;if(self.$container.css('display')!=='none'){const delay=$ush.parseInt(self.triggerOptions.delay);_timeoutHandle=$ush.timeout(self.show.bind(self),delay*1000)}
self.$container.on('usb.refreshedEntireNode',()=>{if(_timeoutHandle){$ush.clearTimeout(_timeoutHandle)}
self.$overlay.remove();self.$wrap.remove()})}else if(self.triggerType==='selector'){const selector=self.$trigger.data('selector');if(selector){$us.$body.on('click',selector,self._events.show)}}else{self.$trigger.on('click',self._events.show)}
self.$wrap=$('.w-popup-wrap',self.$container).on('click',self._events.hide);self.$box=$('.w-popup-box',self.$container);self.$overlay=$('.w-popup-overlay',self.$container);self.$closer.on('click',self._events.hide);self.$wrap.on('click','a',self._events.hideOnLinkClick);self.$media=$('video,audio',self.$box);self.$wVideos=$('.w-video',self.$box);self.timer=null;self.ajaxData={action:'us_list_item_popup_content',};if(self.forListItem&&self.$container.is('[onclick]')){$.extend(self.ajaxData,self.$container[0].onclick()||{});self.ajaxData.post_id=self.$container.parents('.w-grid-item').attr('data-id');self.$container.removeAttr('onclick')}
self.popupSizes={wrapHeight:0,contentHeight:0,}};$us.usPopup.prototype={isKeyboardUsed:function(e){return e&&e.pointerType!=='mouse'&&e.pointerType!=='touch'&&e.pointerType!=='pen'},show:function(e){const self=this;if(e!==_undefined){e.preventDefault()}
if(self.$content.is(':empty')){$ush.timeout(self.loadItemContent.bind(self))}
if(self.triggerType==='load'&&!$us.usbPreview()){const uniqueId=$ush.toString(self.triggerOptions.uniqueId),cookieName='us_popup_'+uniqueId;if(uniqueId){if($ush.getCookie(cookieName)!==null){return}
const daysUntilNextShow=$ush.parseFloat(self.triggerOptions.daysUntilNextShow);$ush.setCookie(cookieName,'shown',daysUntilNextShow||365)}}
$ush.clearTimeout(self.timer);self.$overlay.appendTo($us.$body).show();self.$wrap.appendTo($us.$body).css('display','flex');if(!self.isDesktop){self.$wrap.on('touchmove',self._events.touchmove);$us.$document.on('touchmove',self._events.touchmove)}
$us.$body.on('keyup',self._events.keyup);self.$wrap.on('scroll.noPreventDefault',self._events.scroll);self.timer=$ush.timeout(self._events.afterShow,25);$us.$document.on('keydown.usPopup',self._events.tabFocusTrap);$us.$document.trigger('usPopupOpened',[self.$container]);if(e){self.$closer[0].focus({preventScroll:!0})}},afterShow:function(){const self=this;$ush.clearTimeout(self.timer);self.$overlay.addClass('active');self.$box.addClass('active');if(window.$us!==_undefined&&$us.$canvas!==_undefined){$us.$canvas.trigger('contentChange',{elm:self.$container})}
if(self.$wVideos.length){self.$wVideos.each((_,wVideo)=>{const $wVideoSource=$('[data-src]',wVideo);const $videoTag=$wVideoSource.parent('video');const src=$wVideoSource.data('src');if(!src){return}
$wVideoSource.attr('src',src);if($videoTag.length>0){$videoTag[0].load()}})}
$us.$window.trigger('resize');$us.$document.trigger('usPopup.afterShow',self)},loadItemContent:function(){const self=this;if(!self.forListItem){return}
$.ajax({url:$us.ajaxUrl,type:'POST',dataType:'json',data:self.ajaxData,beforeSend:()=>{self.$content.html('<div class="g-preloader type_1"></div>')},success:(response)=>{if(response.success&&response.data){self.$content.html(response.data);$us.$document.trigger('usPopup.itemContentLoaded',self)}},})},hide:function(e){const self=this;if(e&&$(e.target).closest(self.$box).length&&!$(e.target).hasClass('w-popup-closer')){return}
$ush.clearTimeout(self.timer);$us.$body.off('keyup',self._events.keyup);self.$overlay.on(self.transitionEndEvent,self._events.afterHide);self.$overlay.removeClass('active');self.$box.removeClass('active');self.$wrap.off('scroll.noPreventDefault',self._events.scroll);$us.$document.off('touchmove',self._events.touchmove);self.timer=$ush.timeout(self._events.afterHide,1000);$us.$document.off('keydown.usPopup');if(self.isKeyboardUsed(e)){self.$trigger[0].focus()}},hideOnLinkClick:function(event){const self=this;const $item=$(event.currentTarget);const place=$item.attr('href');if((place.indexOf('#')===-1)||(place!=='#'&&place.indexOf('#')===0&&$(place,self.$wrap).length>0)){return}
self.hide()},afterHide:function(){const self=this;$ush.clearTimeout(self.timer);self.$overlay.off(self.transitionEndEvent,self._events.afterHide);self.$overlay.appendTo(self.$container).hide();self.$wrap.appendTo(self.$container).hide();$us.$document.trigger('usPopupClosed');$us.$window.trigger('resize',!0).trigger('usPopup.afterHide',self);if(self.$media.length>0){self.$media.trigger('pause')}
if(self.$wVideos.length){self.$wVideos.each((_,wVideo)=>{const $wVideoSource=$(wVideo).find('[src]');if(!$wVideoSource.data('src')){$wVideoSource.attr('data-src',$wVideoSource.attr('src'))}
$wVideoSource.attr('src','')})}},savePopupSizes:function(){const self=this;self.popupSizes.wrapHeight=self.$wrap.height();self.popupSizes.contentHeight=self.$content.outerHeight(!0)},tabFocusTrap:function(e,$wrap,$popupCloser,triggerElm){const self=this;self.$wrap=$wrap||self.$wrap;self.$closer=$popupCloser||self.$closer;if(self.$wrap.hasClass('l-popup')){$us.$document.on('usPopupClosed',()=>{if($ush.isNode(triggerElm)){triggerElm.focus()}})}
if(e.keyCode!==$ush.TAB_KEYCODE){return}
const focusableSelectors=['a[href]','area[href]','input:not([disabled])','select:not([disabled])','textarea:not([disabled])','button:not([disabled])','iframe','object','embed','[tabindex]:not([tabindex="-1"])','[contenteditable]','video[controls] source'].join();const $focusable=$(focusableSelectors,self.$wrap).filter((_,node)=>{if($(node).is('video[controls], source')){return!0}
return $(node).is(':visible')});if(!$focusable.length){e.preventDefault();self.$closer[0].focus();return}
const firstElement=$focusable.first()[0];const lastElement=$focusable.last()[0];const target=e.target;if(!$.contains(self.$wrap[0],target)&&$us.$html.hasClass('us_popup_is_opened')&&!$(target).hasClass('w-popup-closer')){e.preventDefault();if(e.shiftKey){lastElement.focus()}else{firstElement.focus()}
return}
if(e.shiftKey&&target===firstElement){e.preventDefault();lastElement.focus()}else if(!e.shiftKey&&target===lastElement){e.preventDefault();firstElement.focus()}}};$.extend($us.usPopup.prototype,{popupPost:function(gridList){if(!gridList.hasClass('open_items_in_popup')){return}
const self=this;self.gridList=gridList;self.$popupPost=$('.l-popup',gridList);self.$popupPostBox=$('.l-popup-box',self.$popupPost);self.$popupPostFrame=$('.l-popup-box-content-frame',self.$popupPost);self.$popupPostToPrev=$('.l-popup-arrow.to_prev',self.$popupPost);self.$popupPostToNext=$('.l-popup-arrow.to_next',self.$popupPost);self.$popupPostCloser=$('.l-popup-closer',self.$popupPost);self.$list=$('.w-grid-list',gridList);$.extend(self._events,{closePostInPopup:self.closePostInPopup.bind(self),closePostInPopupByEsc:self.closePostInPopupByEsc.bind(self),loadPostInPopup:self.loadPostInPopup.bind(self),navInPopup:self.navInPopup.bind(self),openPostInPopup:self.openPostInPopup.bind(self),setPostInPopup:self.setPostInPopup.bind(self)});$us.$body.append(self.$popupPost);self.$list.on('click','.w-grid-item:not(.custom-link) .w-grid-item-anchor',self._events.openPostInPopup);self.$popupPostFrame.on('load',self._events.loadPostInPopup);self.$popupPost.on('click','.l-popup-arrow',self._events.navInPopup).on('click','.l-popup-closer, .l-popup-box',self._events.closePostInPopup)},setPostInPopup:function(index){const self=this;var $node=$('> *:eq('+$ush.parseInt(index)+')',self.$list);if(self.gridList.hasClass('type_carousel')){$node=$('.owl-item:eq('+$ush.parseInt(index)+')',self.$list)}
const url=$ush.toString($('[href]:first',$node).attr('href'));if(!url){console.error('No url to loaded post');return}
const $prev=$node.prev(':not(.custom-link)');const $next=$node.next(':not(.custom-link)');var pageTemplate=self.$popupPostBox.data('page-template');pageTemplate=pageTemplate?`&us_popup_page_template=${pageTemplate}`:'';self.$popupPostToPrev.data('index',$prev.index()).attr('title',$('.post_title',$prev).text()).toggleClass('hidden',!$prev.length);self.$popupPostToNext.data('index',$next.index()).attr('title',$('.post_title',$next).text()).toggleClass('hidden',!$next.length);self.$popupPostBox.addClass('loading');self.$popupPostBox.off('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');self.$popupPostFrame.attr('src',url+(url.includes('?')?'&':'?')+'us_iframe=1'+pageTemplate);history.replaceState(null,null,url)},openPostInPopup:function(e){const self=this;if($us.$window.width()<=$us.canvasOptions.disableEffectsWidth){return}
e.stopPropagation();e.preventDefault();if(!_originalUrl){_originalUrl=location.href}
if(self.gridList.hasClass('type_carousel')){self.setPostInPopup($(e.target).closest('.owl-item').index())}else{self.setPostInPopup($(e.target).closest('.w-grid-item').index())}
self.$popupPost.addClass('active');self.$popupPostBox.addClass('loading');$us.$document.trigger('usPopupOpened',[self.$popupPost,self.$popupPostCloser,e.target]);$ush.timeout(()=>{self.$popupPostBox.addClass('show')},25)},loadPostInPopup:function(){const self=this;self.$popupPost.on('keyup.usCloseLightbox',self._events.closePostInPopupByEsc);$('body',self.$popupPostFrame.contents()).on('keyup.usCloseLightbox',self._events.closePostInPopupByEsc)},navInPopup:function(e){this.setPostInPopup($(e.target).data('index'))},closePostInPopup:function(){const self=this;self.$popupPost.addClass('closing');self.$popupPostFrame.attr('src','about:blank');self.$popupPostBox.removeClass('show').one('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd',$ush.debounce(()=>{self.$popupPost.removeClass('active closing');self.$popupPostToPrev.addClass('hidden');self.$popupPostToNext.addClass('hidden');$us.$document.trigger('usPopupClosed')},1));self.$popupPost.off('keyup.usCloseLightbox');if(_originalUrl){history.replaceState(null,null,_originalUrl)}},closePostInPopupByEsc:function(e){const self=this;if(e.keyCode===$ush.ESC_KEYCODE&&self.$popupPost.hasClass('active')){self.closePostInPopup()}},});$.fn.usPopup=function(options){return this.each(function(){$(this).data('usPopup',new $us.usPopup(this,options))})};$(()=>$('.w-popup').usPopup());$us.$document.on('usPostList.itemsLoaded usGrid.itemsLoaded',(_,$items)=>{$('.w-popup',$items).usPopup()});$us.$document.on('usPopupOpened',(e,$popup,$popupCloser,triggerElm)=>{if($popup.hasClass('l-popup')){if(e){$popupCloser[0].focus({preventScroll:!0})}
$us.$document.on('keydown.usPopup',(e)=>{$us.usPopup.prototype.tabFocusTrap(e,$popup,$popupCloser,triggerElm)})}});$us.$document.on('usPopupClosed',()=>{$us.$document.off('keydown.usPopup')})}(jQuery)