(function($,_undefined){"use strict";const DELETE_FILTER=null;function usPostList(container){const self=this;self.data={paged:1,max_num_pages:1,paginationBase:'page',pagination:'none',ajaxUrl:$us.ajaxUrl,ajaxData:{us_ajax_list_pagination:1,},facetedFilter:{},};self.listFilterUid=null;self.uid=$ush.uniqid();self.xhr;self.$container=$(container);self.$list=$('.w-grid-list',container);self.$loadmore=$('.g-loadmore',container);self.$pagination=$('nav.pagination',container);self.$none=self.$container.next('.w-grid-none');self.isCurrentQuery=self.$container.hasClass('for_current_wp_query');const $opts=$('.w-grid-list-json:first',container);if($opts.is('[onclick]')){$.extend(self.data,$opts[0].onclick()||{})}
$opts.remove();self.paginationType=$ush.toString(self.data.pagination);self.hideIsEmpty=self.$container.closest('.hide_if_inner_list_is_empty').length>0;self._events={addNextPage:self._addNextPage.bind(self),initMagnificPopup:self.initMagnificPopup.bind(self),usListOrder:self.usListOrder.bind(self),usListSearch:self.usListSearch.bind(self),usListFilter:self.usListFilter.bind(self),usbReloadIsotopeLayout:self.usbReloadIsotopeLayout.bind(self),};if(self.paginationType==='load_on_btn'){self.$loadmore.on('mousedown','button',self._events.addNextPage)}else if(self.paginationType==='load_on_scroll'){$us.waypoints.add(self.$loadmore,'-70%',self._events.addNextPage)}
self.$container.add(self.$none).on('usListSearch',self._events.usListSearch).on('usListOrder',self._events.usListOrder).on('usListFilter',self._events.usListFilter);self.$list.on('click','[ref=magnificPopup]',self._events.initMagnificPopup)
if(self.$container.hasClass('open_items_in_popup')){new $us.usPopup().popupPost(self.$container)}
if(self.$container.hasClass('type_masonry')){self.$list.imagesLoaded(()=>{const isotopeOptions={itemSelector:'.w-grid-item',layoutMode:(self.$container.hasClass('isotope_fit_rows'))?'fitRows':'masonry',isOriginLeft:!$('.l-body').hasClass('rtl'),transitionDuration:0};var columnWidth;if($('.size_1x1',self.$list).length>0){columnWidth='.size_1x1'}else if($('.size_1x2',self.$list).length>0){columnWidth='.size_1x2'}else if($('.size_2x1',self.$list).length>0){columnWidth='.size_2x1'}else if($('.size_2x2',self.$list).length>0){columnWidth='.size_2x2'}
if(columnWidth){columnWidth=columnWidth||'.w-grid-item';isotopeOptions.masonry={columnWidth:columnWidth}}
self.$list.on('layoutComplete',()=>{if(_window.USAnimate){$('.w-grid-item.off_autostart',self.$list).removeClass('off_autostart');new USAnimate(self.$list)}
$us.$window.trigger('scroll.waypoints')});self.$list.isotope(isotopeOptions);$us.$canvas.on('contentChange',()=>{self.$list.imagesLoaded(()=>{self.$list.isotope('layout')})})});self.$container.on('usbReloadIsotopeLayout',self._events.usbReloadIsotopeLayout)}
self.initListResultCounter()}
$.extend(usPostList.prototype,{usListSearch:function(e,name,value){this.applyFilter(name,value)},usListOrder:function(e,name,value){this.applyFilter(name,value)},usListFilter:function(e,values){const self=this;$.each(values,self.applyFilter.bind(self))},_addNextPage:function(){const self=this;if($ush.isUndefined(self.xhr)&&!self.$none.is(':visible')){self.addItems()}},applyFilter:function(name,value){const self=this;if($ush.toString(value)=='{}'){value=DELETE_FILTER}
if(name==='list_filters'){$.extend(value,JSON.parse(self.data.ajaxData[name]||'{}'));self.data.ajaxData[name]=JSON.stringify(value);return}
if(name==='list_filter_uid'){self.listFilterUid=value;return}
const pathname=location.pathname;const PAGINATION_PAGE_PATTERN=new RegExp(`\/${self.data.paginationBase}\/?([0-9]{1,})\/?$`);if(PAGINATION_PAGE_PATTERN.test(pathname)){history.pushState({},'',location.href.replace(pathname,pathname.replace(PAGINATION_PAGE_PATTERN,'')+'/'))}
self.data.paged=0;if(self.isCurrentQuery){self.data.ajaxUrl=$ush.urlManager(self.data.ajaxUrl).set(name,value).toString()}else if(value===DELETE_FILTER){delete self.data.ajaxData[name]}else{self.data.ajaxData[name]=value}
if(!$ush.isUndefined(self.xhr)){self.xhr.abort()}
self.addItems(!0)},scrollToList:function(){const self=this;if(self.data.paged>1){return}
const offsetTop=$ush.parseInt(self.$container.offset().top);if(!offsetTop){return}
const scrollTop=$us.$window.scrollTop();if(!$ush.isNodeInViewport(self.$container[0])||offsetTop>=(scrollTop+window.innerHeight)||scrollTop>=offsetTop){$us.$htmlBody.stop(!0,!1).animate({scrollTop:(offsetTop-$us.header.getInitHeight())},500)}},addItems:function(listFiltersApplied){const self=this;self.data.paged+=1;if(!listFiltersApplied&&self.data.paged>self.data.max_num_pages){return}
if(listFiltersApplied){self.$container.addClass('filtering');if(self.$container.hasClass('preload_style_spinner')){self.$loadmore.removeClass('hidden').addClass('loading')}}else{self.$loadmore.removeClass('hidden').addClass('loading')}
if(!self.hideIsEmpty){self.$container.removeClass('hidden')}
self.$pagination.addClass('hidden');var ajaxUrl=$ush.toString(self.data.ajaxUrl),ajaxData=$ush.clone(self.data.ajaxData),numPage=$ush.rawurlencode('{num_page}');if(ajaxUrl.includes(numPage)){ajaxUrl=ajaxUrl.replace(numPage,self.data.paged)}else if(ajaxData.template_vars){ajaxData.template_vars=JSON.stringify(ajaxData.template_vars);ajaxData.paged=self.data.paged}
self.xhr=$.ajax({type:'post',url:ajaxUrl,dataType:'html',cache:!1,data:ajaxData,success:(html)=>{if(listFiltersApplied){self.$list.html('');self.$none.addClass('hidden')}
var $listJson=$('.w-grid-list-json:first',html);if($listJson.is('[onclick]')){if($listJson[0].onclick===null){$listJson[0].onclick=new Function($listJson.attr('onclick'))}
$.extend(!0,self.data,$listJson[0].onclick()||{})}
var $items=$(html).find('.w-grid-list').first().children();const numAjaxParams=Object.keys($ush.urlManager(self.data.ajaxUrl).toJson(!1)).length;var filterIsClear=numAjaxParams<=1;if(self.paginationType==='numbered'){filterIsClear=numAjaxParams<1}
$ush.timeout(()=>{const data={postListUid:self.uid,listFilterUid:self.listFilterUid,listFiltersApplied:listFiltersApplied,};$us.$document.trigger('usPostList.itemsLoaded',[$items,data])},50);if(self.hideIsEmpty){self.$container.toggleClass('hidden',$items.length===0)}
if(!$items.length){if(!self.$none.length){self.$none=$('.w-grid-none:first',html);if(!self.$none.length){self.$none=$(html).filter('.w-grid-none:first')}
self.$container.after(self.$none)}
self.$container.removeClass('filtering');self.$loadmore.addClass('hidden');self.$pagination.addClass('hidden');self.$none.removeClass('hidden');return}
if(self.$container.hasClass('type_masonry')){self.$list.isotope('insert',$items).isotope('reloadItems')}else{self.$list.append($items)}
if(window.USAnimate&&self.$container.hasClass('with_css_animation')){new USAnimate(self.$list);$us.$window.trigger('scroll.waypoints')}
if(self.paginationType=='numbered'){const $pagination=$('nav.pagination',html);if($pagination.length&&!self.$pagination.length){self.$list.after($pagination.prop('outerHTML'));self.$pagination=self.$list.next('nav.pagination')}
if(self.$pagination.length&&$pagination.length){self.$pagination.html($pagination.html()).removeClass('hidden')}else{self.$pagination.addClass('hidden')}}
if(self.data.paged>=self.data.max_num_pages){self.$loadmore.addClass('hidden');self.$none.addClass('hidden')}else{self.$loadmore.removeClass('hidden')}
if(self.paginationType=='load_on_scroll'){$us.waypoints.add(self.$loadmore,'-70%',self._events.addNextPage)}
$us.$canvas.trigger('contentChange')},complete:()=>{self.$container.removeClass('filtering');self.$loadmore.removeClass('loading');if(self.paginationType==='load_on_scroll'){self.$loadmore.addClass('hidden')}
delete self.xhr;self.scrollToList()}})},usbReloadIsotopeLayout:function(){const self=this;if(self.$container.hasClass('with_isotope')){self.$list.isotope('layout')}},});$.extend(usPostList.prototype,{initListResultCounter:function(){const self=this;const listResultCounterOpts=[];self.$listResultCounter=$('.w-list-result-counter');if(!(self.$listResultCounter.length&&self.isCurrentQuery)){return}
self.$listResultCounter.each((_,node)=>{const $node=$(node);if($node.is('[onclick]')){listResultCounterOpts.push(node.onclick()||{});$node.removeAttr('onclick')}});self._events.updateCountResults=function(_,$items,data){if(data.postListUid===self.uid){$.each(listResultCounterOpts,(index,opts)=>{const foundPosts=(self.paginationType==='none')?$('> *',self.$list).length:self.data.ajaxData.found_posts;self.countResult(foundPosts,opts,index)})}};$us.$document.on('usPostList.itemsLoaded',self._events.updateCountResults);const numAjaxParams=Object.keys($ush.urlManager(self.data.ajaxUrl).toJson(!1)).length;$.ajax({url:$us.ajaxUrl,type:'POST',dataType:'json',data:{action:'us_list_result_counter_total',query_args_unfiltered:self.data.facetedFilter.query_args_unfiltered,},success:(res)=>{if(!res.success){console.error(res.data.message);return}
if(res.data.total_unfiltered){$('.total-unfiltered',self.$listResultCounter).text(res.data.total_unfiltered)}
$.each(listResultCounterOpts,(index,opts)=>{if(opts.totalUnfiltered!==res.data.total_unfiltered&&self.paginationType!=='none'&&numAjaxParams<=1){self.countResult(self.data.ajaxData.found_posts,opts,index)}})},});if(self.paginationType==='none'&&numAjaxParams<=1){$.each(listResultCounterOpts,(index,opts)=>{self.countResult($('> *',self.$list).length,opts,index)})}
if(self.paginationType==='numbered'){if(!(numAjaxParams<1)){$.each(listResultCounterOpts,(index,opts)=>{self.countResult(self.data.ajaxData.found_posts,opts,index)})}}else if(!(numAjaxParams<=1)){const total=(self.paginationType==='none')?$('> *',self.$list).length:self.data.ajaxData.found_posts;$.each(listResultCounterOpts,(index,opts)=>{self.countResult(total,opts,index)})}},countResult:function(total,opts,index){const self=this;if(!self.$listResultCounter.length||!self.isCurrentQuery||$us.usbPreview()){return}
const $listResultCounter=self.$listResultCounter.eq(index);const $noResultsSpan=$('.no-results',$listResultCounter);const $oneResultSpan=$('.one-result',$listResultCounter);const $mainSpan=$('span:first-child',$listResultCounter);$listResultCounter.show();$mainSpan.show();$noResultsSpan.addClass('hidden');$oneResultSpan.addClass('hidden');const lower=['load_on_scroll','load_on_btn'].includes(self.paginationType)?1:(self.data.paged-1)*opts.perPage+1;const upper=self.paginationType==='none'?$('> *',self.$list).length:Math.min(total,self.data.paged*opts.perPage);if(total===1){$mainSpan.hide();$oneResultSpan.removeClass('hidden')}else if(total===0){if($noResultsSpan.length){$mainSpan.hide();$noResultsSpan.removeClass('hidden')}else{$listResultCounter.hide()}}else{$('.lower',$listResultCounter).text(lower);$('.upper',$listResultCounter).text(upper);$('.total',$listResultCounter).text(total)}},});$.extend(usPostList.prototype,{initMagnificPopup:function(e){e.stopPropagation();e.preventDefault();const $target=$(e.currentTarget);if($target.data('magnificPopup')===_undefined){$target.magnificPopup({type:'image',mainClass:'mfp-fade'});$target.trigger('click')}},});$.fn.usPostList=function(){return this.each(function(){$(this).data('usPostList',new usPostList(this))})};$(()=>$('.w-grid.us_post_list, .w-grid.us_product_list').usPostList())})(jQuery)